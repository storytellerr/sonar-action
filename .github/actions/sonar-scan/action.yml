# .github/actions/sonar-scan/action.yml
name: "Reusable SonarQube Analysis"
description: "Run SonarQube analysis with dynamic project names for pull requests and main branch"

inputs:
  project_key:
    description: "SonarQube project key"
    required: true
  sonar_host_url:
    description: "SonarQube server URL"
    required: true
  sonar_token:
    description: "SonarQube authentication token"
    required: true

runs:
  using: "composite"
  steps:
    - name: Set up Java
      uses: actions/setup-java@v2
      with:
        java-version: "11"
        distribution: 'adoptopenjdk'
        java-package: 'jdk'
        cache: 'true'


    - name: Install SonarScanner
      run: |
        wget https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-4.6.2.2472-linux.zip
        unzip sonar-scanner-cli-4.6.2.2472-linux.zip
        export PATH="$PATH:$(pwd)/sonar-scanner-4.6.2.2472-linux/bin"
      shell: bash

    - name: Verify SonarScanner installation
      run: |
        sonar-scanner --version
      shell: bash
      
    - name: Run SonarQube Scanner
      run: |
        sonar-scanner \
          -Dsonar.projectKey=${{ inputs.project_key }} \
          -Dsonar.host.url=${{ inputs.sonar_host_url }} \
          -Dsonar.login=${{ inputs.sonar_token }}
      shell: bash
